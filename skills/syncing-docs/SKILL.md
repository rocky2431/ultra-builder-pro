---
name: syncing-docs
description: "Keeps documentation synchronized with code and decisions. This skill activates after /ultra-research, feature completion, architecture changes, or /ultra-deliver."
---

# Documentation Synchronization

Ensures documentation reflects current reality.

## Activation Context

This skill activates during:
- After /ultra-research completion
- Feature completion
- Architecture changes
- /ultra-deliver execution
- Documentation-related discussions

## Resources

| Resource | Purpose |
|----------|---------|
| `scripts/doc_sync.py` | Check and manage documentation |

## Documentation Management

### Check for Drift

```bash
python scripts/doc_sync.py check
```

## Documentation Locations

**New projects (.ultra/specs/):**
- `.ultra/specs/product.md` - Personas, Scenarios, User Stories, Features Out
- `.ultra/specs/architecture.md` - arc42 structure (12 sections)

**Legacy projects (docs/):**
- `docs/prd.md` - Product requirements
- `docs/tech.md` - Technical decisions

**Always:**
- `.ultra/docs/research/` - Research reports

## Synchronization Tasks

### After Research

When research introduces new information:
- Update relevant specification file with findings
- Flag `[NEEDS CLARIFICATION]` for unresolved items

### After Feature Completion

Check alignment between:
- User Stories (product.md §4) and implemented features
- Building Blocks (architecture.md §5) and actual code structure

## Drift Detection

Look for misalignment:
- Features in code not documented in specs
- Specs describing features not yet implemented
- Architecture docs not matching actual structure
- Stale markers: `[NEEDS CLARIFICATION]`, `[TODO]`, `[TBD]`

## Safe Auto-Creation

Create these files automatically:
- Tech debt entries in `.ultra/docs/tech-debt.md`
- Research reports in `.ultra/docs/research/`
- **Project-level CLAUDE.md** in project root

---

## Project-Level CLAUDE.md Generation

### Purpose

Generate and maintain a project-specific `CLAUDE.md` at project root. Claude Code automatically reads this file, providing project context for every conversation.

### Trigger Conditions

Generate/update CLAUDE.md when:
1. `/ultra-research` completes (full generation)
2. Task completes via `/ultra-dev` (update "Current Focus")
3. `.ultra/specs/` files are modified (incremental update)
4. `/ultra-deliver` completes (add release info)

### Content Structure

```markdown
# {Project Name}

## Project Overview
{1-2 paragraph summary from .ultra/specs/product.md}

## Tech Stack
{Extracted from .ultra/specs/architecture.md}
- Frontend: {framework}
- Backend: {framework}
- Database: {database}
- Testing: {framework}

## Development Rules
{Core rules from architecture decisions}
- Code style: {convention}
- Test coverage: ≥{X}%
- Commit format: Conventional Commits

## Known Risks
{Active risks from risk assessment}
- [High] {risk}: {mitigation}
- [Medium] {risk}: {mitigation}

## Current Focus
{From tasks.json - in_progress and next pending}
- In Progress: Task #{id} - {title}
- Next: Task #{id} - {title}

---
*Auto-generated by syncing-docs skill | Last updated: {timestamp}*
```

### Generation Process

**Step 1: Read Source Files**
```
.ultra/specs/product.md      → Project Overview
.ultra/specs/architecture.md → Tech Stack, Development Rules
.ultra/docs/research/*.md    → Known Risks (from risk assessment)
.ultra/tasks/tasks.json      → Current Focus
```

**Step 2: Extract Content**
- Project name from architecture.md §1 or directory name
- Problem Statement from product.md §1 for overview
- Tech stack from architecture.md §4 (Solution Strategy)
- Risks from architecture.md §11 (High/Medium only)
- First in_progress task + first pending task

**Step 3: Generate CLAUDE.md**
- Write to project root (not .ultra/)
- Limit to ~500 words to minimize token usage
- Include generation timestamp

**Step 4: Update .gitignore**
- Ensure `CLAUDE.local.md` is in .gitignore (personal config)
- `CLAUDE.md` should be committed (shared team context)

### Update Rules

| Change Type | Update Action |
|-------------|---------------|
| .ultra/specs/product.md changed | Regenerate "Project Overview" |
| .ultra/specs/architecture.md changed | Regenerate "Tech Stack" + "Development Rules" |
| Task status changed | Update "Current Focus" only |
| Risk assessment updated | Regenerate "Known Risks" |
| Full research completed | Full regeneration |

### Quality Constraints

- **Max length**: 500 words (minimize token cost)
- **No duplication**: Reference .ultra/specs/ for details, don't copy
- **Actionable**: Rules should be specific, not vague
- **Current**: Always reflect latest project state

## Output Format

Provide updates in Chinese at runtime:

```
文档同步检查
========================

发现：
- {具体发现或建议}

建议更新：
- {文件路径}: {需要更新的内容}

========================
```

**Tone:** Helpful, proactive
